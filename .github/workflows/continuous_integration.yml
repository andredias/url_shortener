name: Continuous Integration

on: [push]

jobs:

  lint_and_test:
    runs-on: ubuntu-latest
    steps:

        - name: Set up python
          uses: actions/setup-python@v6
          with:
            python-version-file: "pyproject.toml"

        - name: Check out repository
          uses: actions/checkout@v5

        - name: Install uv
          uses: astral-sh/setup-uv@v6
          with:
            version: "0.9.8"
            enable-cache: true

        - name: Install dependencies
          run: uv sync --locked --no-install-project

        - name: Run tests
          run: uv run make test

        - name: Build Docker Image
          run: uv run make build

        - name: Minimize uv cache
          run: uv cache prune --ci
